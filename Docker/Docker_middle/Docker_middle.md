# Docker_middle

## Вопрос 1  
Вы запускаете контейнер с помощью команды: docker run -it ubuntu --rm  
Ожидалось, что контейнер запустится и автоматически удалится после завершения работы.  
Однако команда завершается с ошибкой, и контейнер даже не создается.  
В чем причина ошибки при запуске?  

- Образ ubuntu в целом осуществляет автоматическое удаление контейнеров таким способом  
- Для использования флага --rm требуется обязательно использовать docker-compose  
- Флаг --rm указан после имени образа, поэтому Docker CLI считает его не валидным  
- Интерактивный режим -it в команде docker run -it ubuntu --rm несовместим с автоматическим удалением  
- Системный демон Docker не поддерживает в команде docker run -it ubuntu флаг --rm  

---

## Вопрос 2  
При разработке Dockerfile для веб-приложения в облаке вы столкнулись с проблемами:  
* Итоговый образ увеличился на 30% по размеру.  
* Сборка образа стала медленнее почти в два раза.  
* Внутри образа остались временные файлы после выполнения apt-get update и apt-get install.  
Какой метод написания Dockerfile объясняет, почему объединение всех команд установки и удаления временных файлов в рамках одной инструкции RUN решает все три проблемы одновременно?  

- Каждая команда устанавливается отдельно, что ускоряет диагностику ошибок при сборке  
- Удаление временных файлов в отдельной инструкции позволяет упростить их поиск в процессе отладки  
- Вынос удаления временных файлов в отдельный этап помогает сохранить порядок в структуре Dockerfile  
- Все изменения выполняются в одном слое, временные файлы удаляются до фиксации слоя, что уменьшает размер и ускоряет сборку  
- Создание дополнительных слоев через несколько инструкций RUN увеличивает возможности кэширования  

---

## Вопрос 3  
Вы используете следующий Docker Compose файл:  

version: '3.8'  
services:  
  api:  
    image: myapi:latest  
    environment:  
      API_KEY: key123  
  redis:  
    image: redis:latest  

При запуске контейнеров сервис api не может подключиться к redis, а в логах сервиса api фиксируются ошибки соединения с сетью.  
Что поможет решить эту проблему?  

- Добавить переменные окружения для сервиса redis и подключение обоих сервисов к одной сети  
- Перезапуск Compose файла с флагом --force-recreate и подключение двух сервисов к одной сети  
- Смена версии Compose файла на 2.1 и подключение обоих сервисов к одной сети  
- Удаление настройки environment из сервиса api и подключение сервисов к одной сети  
- Добавление секции networks в Compose файл и подключение сервисов к одной сети  

---

## Вопрос 4  
Вы разворачиваете распределённое приложение в Docker Swarm. Контейнеры должны быть развернуты как сервисы и иметь возможность взаимодействовать друг с другом вне зависимости от того, на каких узлах они находятся.  
Что вы должны использовать для настройки сети и запуска контейнеров?  

- Команду docker run --net-host для каждого контейнера, чтобы подключить их к сети хоста  
- Сеть overlay и команду docker service create для развертывания контейнеров  
- Сеть custom и команду docker network connect, чтобы подключить все контейнеры  
- Сеть macvlan и команду docker network create, чтобы дать контейнерам собственные MAC- и IP-адреса  
- Сеть bridge и команду docker network create для создания сети, а затем подключить контейнеры к этой сети  

---

## Вопрос 5  
Контейнер web-app начал перегружать CPU до 100%. Ваша задача:  
1. Определить, какие процессы внутри контейнера создают наибольшую нагрузку.  
2. Получить текущие метрики использования памяти, CPU и сетевых ресурсов.  
3. Скопировать файл логов /var/log/app.log на хост в директорию /tmp для последующего анализа.  
Условие: Интерактивный вход в контейнер использовать нельзя.  

- Запустить docker logs --tail 100 для просмотра последних ошибок, использовать docker exec для анализа процессов и затем скопировать файл через docker cp  
- Остановить контейнер через docker stop, сохранить состояние через docker commit и скопировать файл через docker cp  
- Выполнить docker kill для немедленного завершения контейнера, затем собрать логи через docker logs и скопировать их через docker cp  
- Использовать docker inspect для получения состояния контейнера, затем docker cp для копирования логов и docker logs для диагностики  
- Использовать docker top для процессов, docker stats для метрик и docker cp для копирования файлов  

---

## Вопрос 6  
Вы настраиваете тестовое окружение для микросервисного приложения. Требуется развернуть локальный Docker Registry, который будет доступен только из локальной сети. При этом необходимо:  
* обеспечить запуск на порту 5000  
* исключить доступ извне  
* предотвратить несанкционированную публикацию образов  
Какая конфигурация запуска и настройка среды обеспечит выполнение всех этих условий?  

- Ограничить внешний доступ к Registry через правила фаервола и настроить запуск контейнера с публикацией порта 5000.  
- Запустить Docker Registry с флагом --insecure-registry, чтобы упростить доступ внутри сети  
- Использовать сеть host, чтобы скрыть порт от внешней среды  
- Запустить Docker Registry на произвольном порту и использовать NAT для фильтрации доступа  
- Развернуть Docker Registry в сети bridge и использовать переменную REGISTRY_HTTP_ADDR=0.0.0.0:5000  

---

## Вопрос 7  
Контейнер backend-api, использующий данные из оперативной памяти, завис. Вам необходимо:  
1. Временно заморозить его выполнение для дампа состояния.  
2. После анализа возобновить работу без потери данных.  
3. При критической ошибке — аварийно завершить контейнер немедленно.  

- Настроить автоматический перезапуск контейнера через политику restart=always и завершить его вручную при необходимости  
- Остановить контейнер через docker stop, создать дамп состояния вручную и перезапустить через docker start  
- Использовать docker-compose pause для паузы, docker-compose unpause для восстановления и docker kill для завершения  
- Выполнить docker wait для ожидания завершения контейнера, сохранить дамп состояния через внешний процесс и завершить через docker kill  
- Приостановить через docker pause, возобновить через docker unpause, завершить через docker kill  

---

## Вопрос 8  
Какой способ подключения связанного тома для сохранения данных контейнера НЕ поможет для успешной работы с ним?  

- Применение bind-монтирования с --mount type=bind, привязывая директорию хоста к контейнеру  
- Добавление параметра VOLUME в Dockerfile для автоматического создания тома без явной привязки  
- Использование временной файловой системы --tmpfs, где данные хранятся в оперативной памяти  
- Использование тома, созданного через docker volume create, с последующей его привязкой к контейнеру с флагом -v  
- Использование сети для хранения данных через NFS или CIFS, монтируя их в контейнер  

---

## Вопрос 9  
Вы администрируете систему, где контейнер Nginx используется для хранения логов. Эти логи содержат информацию о действиях пользователей и системных событиях, которые важны для анализа и диагностики. Вам нужно регулярно сохранять их копии в отдельную директорию на хосте, чтобы избежать потери данных при сбое контейнера. Также важно, чтобы процесс резервного копирования не прерывал работу Nginx и оставался полностью автоматизированным.  
Выберите подходящий метод.  

- Настроить задачу cron для автоматического копирования логов из контейнера на хост  
- Настроить контейнер Nginx в режиме read-only для полной защиты данных пользователей  
- Подключить том Docker к контейнеру Nginx и настроить синхронизацию с хостовой системой  
- Сохранять логи внутри файловой системы контейнера Nginx без подключения тома  
- Использовать параметр --restart=no для контейнера Nginx, чтобы периодически его перезапускать  

---

## Вопрос 10  
Какой инструмент позволяет эффективно собирать и анализировать журналы из множества контейнеров в кластере?  

- Docker CLI  
- Grafana  
- Fluentd  
- Elastic Stack  
- Prometheus  

---

## Вопрос 11  
Вы анализируете производительность микросервисного приложения в Docker-контейнерах с использованием Grafana и Elastic Stack. Один из сервисов начал работать медленнее, чем ожидалось, а логи показывают регулярные таймауты. Мониторинг фиксирует высокие задержки при взаимодействии с базой данных: трафик идет через виртуальные интерфейсы bridge-сети Docker и NAT, что дает дополнительную прослойку.  
Что произойдет, если заменить стандартную сеть Docker bridge на host?  

- Таймауты при взаимодействии с базой данных могут сохраняться, если проблема связана с ограничением ресурсов хоста  
- Задержки при взаимодействии с базой данных уменьшатся, так как сеть host упрощает маршрутизацию  
- Пропадет возможность изолировать сеть контейнеров, так как сеть host напрямую использует сетевые интерфейсы хоста  
- Проблема лимита подключений к базе данных останется, так как она не связана с типом сети Docker  
- Скорость взаимодействия между контейнерами повысится, так как сеть host устраняет часть сетевых накладных расходов  

---

## Вопрос 12  
В Jenkins-пайплайне используется Docker для запуска тестовой среды в изолированном контейнере.  
Какое основное преимущество дает автоматизация тестирования в Docker-контейнере по сравнению с ручной настройкой окружения на каждой машине?  

- Docker позволяет создать изолированное окружение для тестов без влияния на основную систему Jenkins  
- Docker упрощает настройку агрегации тестовых отчетов, но не исключает конфигурацию приложений для их создания  
- Docker уменьшает объем тестовых сценариев с плагинами Jenkins, ускоряя работу пайплайна  
- В Jenkins-пайплайне Docker устраняет необходимость проверки кода перед его сборкой  
- Docker позволяет автоматически подтягивать образы с актуальными зависимостями для тестирования  

---

## Вопрос 13  
Ваш локальный Docker Registry уже настроен, запущен и работает на порту 5000. Однако вы заметили, что к нему могут подключаться любые пользователи из вашей сети. Чтобы предотвратить несанкционированный доступ и защитить ваши образы, вы решили повысить безопасность и ограничить доступ.  
Как это сделать?  

- Установить сертификаты TLS/SSL для Docker Registry, чтобы обеспечить защищенное соединение  
- Включить Docker Content Trust для подписывания и проверки образов, а параметр --insecure-registry для ограничения доступа  
- Перевести Docker Registry в режим read-only, чтобы предотвратить изменение образов  
- Настроить аутентификацию с использованием Htpasswd и подключить ее к Docker Registry  
- Настроить брандмауэр на сервере для ограничения доступа к Registry по IP-адресам  

---

## Вопрос 14  
Вы разворачиваете контейнеры в среде, где хост используется для обработки высоконагруженных сетевых операций. При этом контейнер должен использовать IP-адрес хоста, чтобы минимизировать задержки. Какой сетевой режим Docker следует использовать для приложения с высокими сетевыми нагрузками, если требуется доступ к IP хоста и минимальные задержки?  
Как поступить в этом случае?  

- Создать сеть bridge и подключить контейнер к ней с помощью docker network connect  
- Использовать команду docker run --net=none для полной изоляции контейнера от сети хоста  
- Использовать команду docker run --net=host для подключения контейнера к сети хоста  
- Настроить сеть custom и добавить контейнер через команду docker network create  
- Создать сеть overlay и подключить контейнер к ней для использования IP-адреса хоста  

---

## Вопрос 15  
Вы работаете над Dockerfile для создания образа микросервисного приложения. Во время тестирования вы обнаружили следующие проблемы:  
* Размер образа слишком велик и его загрузка занимает много времени  
* Во время работы контейнера возникают ошибки, связанные с отсутствием необходимых пакетов  
* Сборка занимает значительно больше времени из-за повторной установки зависимостей  
Что поможет исправить все эти ошибки в структуре Dockerfile?  

- Использование промежуточного образа multi-stage build для установки и сборки всех компонентов и анализ списка устанавливаемых пакетов  
- Установление всех зависимостей в одном слое Dockerfile для уменьшения количества слоев и анализ списка устанавливаемых пакетов  
- Объединение всех инструкций RUN в один слой для минимизации числа слоев  
- Добавление команды для удаления временных файлов и кэша после установки зависимостей  
- Установка зависимостей во время запуска контейнера, а не во время его сборки  

---

## Вопрос 16  
Ваш Docker Compose файл для микросервисного приложения имеет следующую структуру:  

version: '3.8'
services:
  service1:
    image: service1:latest
    environment:
      VAR: value
  service2:
    image: service2:latest
    volumes:
      - service_data:/data
volumes:
  service_data:
    driver: local

Сервисы запускаются успешно, но в логах service2 появляются ошибки, указывающие на недоступность тома service_data.
Что может быть причиной этого?

- Отсутствие healthcheck для service2, который использует данный том
- Отсутствие указания драйвера для тома service_data
- Неверная версия Compose файла, которая не поддерживает volumes
- Проблема с настройкой прав доступа для тома service_data
- Неправильное указание имени тома в сервисе service2

---

## Вопрос 17

В какой последовательности действий можно организовать резервное копирование данных из Docker-контейнера, использующего именованный том?

- Удалить контейнер. Создать новый контейнер с томом. Выполнить резервное копирование с помощью docker cp
- Использовать docker exec для архивации данных в томе. Удалить контейнер. Скопировать архив из тома через docker volume inspect
- Остановить контейнер. Использовать docker cp для копирования данных из тома. Запустить контейнер
- Создать контейнер с подключённым томом. Выполнить архивацию содержимого тома внутри контейнера. Скопировать архив на хост
- Использовать docker save для сохранения тома в архив. Переместить архив на другой хост. Восстановить данные с помощью docker load

---

## Вопрос 18

Вы выполняете команду docker tag my_image my_registry/my_image.v1, чтобы присвоить образу тег перед загрузкой в реестр.
Затем выполняете docker push my_registry/my_image.v1, но команда завершается с ошибкой. Образ не загружается в реестр, а вывод указывает на проблемы.
Какие ошибки в конфигурации могли вызвать эту проблему?

- Использование образа, который был создан на основе старой версии Docker и несовместим с текущей версией реестра
- Отсутствие предварительной авторизации через команду docker login в реестре, что не позволяет загрузить образ
- Неправильное указание имени реестра и образа при создании тега, что делает загрузку невозможной
- Отсутствие флага --force при создании тега, что не позволяет перезаписать уже существующий тег в реестре
- Несоответствие версии Docker клиента и реестра, что вызвало отказ в загрузке

---

## Вопрос 19

Вы используете Prometheus и cAdvisor для мониторинга контейнеров в производственной среде. Один из контейнеров неожиданно начал генерировать большое количество ошибок записи в логах. Сетевые метрики показывают высокую активность, использование CPU остается стабильным, а потребление дискового пространства значительно увеличивается. Логи контейнера настроены на использование стандартного драйвера json-file, и в Docker Compose файле отсутствуют ограничения размера логов.
Какие изменения произойдут, если поменять стандартный драйвер json-file на драйвер syslog?

- Использование драйвера syslog разгрузит локальную файловую систему, так как логи будут отправляться на удаленный сервер
- Улучшится производительность контейнера, так как запись логов на удаленный сервер снижает нагрузку на файловую систему
- Ошибка записи логов будет полностью устранена, так как проблемы с форматированием в json-file исчезнут
- Логи станут менее доступны для локального анализа, так как syslog предполагает отправку данных на внешний сервер
- Потребление сетевых ресурсов увеличится, так как драйвер syslog требует передачи данных по сети

---

## Вопрос 20

Как Docker помогает обеспечить идентичность окружения между этапами тестирования и продакшена в Jenkins CI/CD пайплайне?

- Автоматически деплоит приложение в продакшен и исключает различия между окружениями
- Создает один и тот же образ для всех этапов пайплайна, исключая различия между окружениями
- Позволяет изолировать приложение в среде, идентичной продакшену
- Сохраняет состояние контейнера между всеми этапами данного пайплайна
- Автоматически проверяет корректность настроек CI/CD и исключает различия между окружениями